<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø³Ø­ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ PDF</title>
  <style>
    body { font-family: sans-serif; direction: rtl; text-align: center; padding: 20px; }
    video { width: 100%; max-width: 400px; border: 2px solid #333; }
    #images-container { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 10px; }
    .captured-image { width: 100px; border: 1px solid #ccc; }
    button { margin: 10px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>

<h2>ğŸ“„ Ù…Ø³Ø­ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ PDF</h2>
<video id="video" autoplay muted></video><br>
<button id="capture">ğŸ“· Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø©</button>
<button id="send">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ PDF</button>
<div id="images-container"></div>

<!-- EmailJS SDK -->
<script type="module">
import emailjs from 'https://cdn.emailjs.com/dist/email.min.mjs';
import { jsPDF } from 'https://cdn.jsdelivr.net/npm/jspdf@2.5.1/+esm';

emailjs.init("zFJcqWYZluBTdU696"); // Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø¹Ø§Ù…

const video = document.getElementById("video");
const captureBtn = document.getElementById("capture");
const sendBtn = document.getElementById("send");
const imagesContainer = document.getElementById("images-container");

const images = [];

// ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => { video.srcObject = stream; })
  .catch(err => {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù†.");
    console.error(err);
  });

// Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©
captureBtn.addEventListener("click", () => {
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0);
  const dataUrl = canvas.toDataURL("image/jpeg", 1.0);
  images.push(dataUrl);

  const img = document.createElement("img");
  img.src = dataUrl;
  img.className = "captured-image";
  imagesContainer.appendChild(img);
});

// Ø¥Ø±Ø³Ø§Ù„ PDF Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯
sendBtn.addEventListener("click", async () => {
  if (images.length === 0) {
    alert("â— Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
    return;
  }

  const password = prompt("ğŸ”’ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù:");
  if (password !== "1234") {
    alert("âŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­.");
    return;
  }

  // Ø¥Ù†Ø´Ø§Ø¡ PDF
  const pdf = new jsPDF();
  for (let i = 0; i < images.length; i++) {
    if (i > 0) pdf.addPage();
    pdf.addImage(images[i], "JPEG", 10, 10, 190, 260); // Ø­Ø¬Ù… A4 ØªÙ‚Ø±ÙŠØ¨ÙŠ
  }

  const pdfBase64 = pdf.output("datauristring"); // ØµÙŠØºØ© base64

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª EmailJS
  const params = {
    to_email: "projtest630@gmail.com",
    subject: "ğŸ“ Ù…Ø³ØªÙ†Ø¯ PDF Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹",
    message: "Ø§Ù„Ù…Ø±ÙÙ‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¨ØµÙŠØºØ© PDF.",
    attachments: pdfBase64, // Ø§Ù„Ù…Ø±ÙÙ‚ Ø¨ØµÙŠØºØ© base64
  };

  try {
    const res = await emailjs.send("service_nzkqggq", "template_w8hwogh", params);
    alert("âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!");
    images.length = 0;
    imagesContainer.innerHTML = "";
  } catch (err) {
    console.error(err);
    alert("âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
  }
});
</script>

</body>
</html>
